name: Check for dangerous functions
  run: |
    echo "Checking for potentially dangerous PHP functions..."
    if grep -rE '\b(eval|system|shell_exec|proc_open|popen)\s*\(' src/ --exclude-dir=vendor | grep -v 'ffmpeg' | grep -v 'video_process'; then
      echo "❌ Found dangerous function usage"
      grep -rn -E '\b(eval|system|shell_exec|proc_open|popen)\s*\(' src/ --exclude-dir=vendor | grep -v 'ffmpeg' | grep -v 'video_process'
      exit 1
    fi
    if grep -rE '\bpassthru\s*\(' src/ --exclude-dir=vendor | grep -v 'fpassthru'; then
      echo "❌ Found passthru() usage (not fpassthru)"
      exit 1
    fi
    echo "✅ No dangerous functions found"
